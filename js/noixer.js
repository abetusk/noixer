// License: CC0
//

var noixer_info = {
  "sound_order" : [
		"156049__ali-k__spring-night-rain2-evosmos-salonika-03-15-15-05",
		"155940__ali-k__small-waterfall-pentalofos-salonika-21-33-30-04",
		"450755__florianreichelt__waves-of-hawaii",
		"32655__greysound__frogsandcrickets-excerptb-jma-24bit-48k",
		"433783__cagancelik__campfire",
		"517042__sonidosreales245__forestday-bw-66",
		"252645__yetcop__cat-purr-gato-ronroneando",
		"501115__felix-blume__peal-of-church-bells-on-sunday-in-paris",
		"60956__muvee69__int-subway-station",
		"525052__smand__wind-chime-small.mp3",
		"448378__keng-wai-chane-chick-te__city-brussels-street-morning",
		"394290__epicwizard__bar-crowd-in-belgrade",
		"197804__7778__indoor-fish-tank-without-bubble-strips-ambiance",
		"234458__theonlycanvas__dryer",
		"345029__3bagbrew__evening-call-to-prayer",
		"273643__sanctuarymuch__ethereal-voices",
		"530715__jjbbllkk__rmr-morphagene-reels-choirs-02",
		"521549__buddhassoundofsilence__singing-bowl-deep-sound",
		"320351__guardian2433__police-radio-chatter",
    "133099__allh__steam-train-interior_e",
    "260105__joshs__train",
    "324404__joedeshon__film-static-03"
	],

  "sound" : {

    "156049__ali-k__spring-night-rain2-evosmos-salonika-03-15-15-05" : {
      "ui_id": "audio0",
      "id" : "156049__ali-k__spring-night-rain2-evosmos-salonika-03-15-15-05",
      "location" : "assets/156049__ali-k__spring-night-rain2-evosmos-salonika-03-15-15-05.mp3",
      "tag" : [ "rain", "thunder" ],
      "state" : "idle",
      "volume": 1.0
    },

    "155940__ali-k__small-waterfall-pentalofos-salonika-21-33-30-04" : {
      "ui_id": "audio1",
      "id" : "155940__ali-k__small-waterfall-pentalofos-salonika-21-33-30-04",
      "location" : "assets/155940__ali-k__small-waterfall-pentalofos-salonika-21-33-30-04.mp3",
      "tag" : [ "waterfall" ],
      "state" : "idle",
      "volume": 1.0
    },

    "450755__florianreichelt__waves-of-hawaii" : {
      "ui_id": "audio2",
      "id" : "450755__florianreichelt__waves-of-hawaii",
      "location" : "assets/450755__florianreichelt__waves-of-hawaii.mp3",
      "tag" : [ "waves" ],
      "state" : "idle",
      "volume": 1.0
    },

    "32655__greysound__frogsandcrickets-excerptb-jma-24bit-48k": {
      "ui_id": "audio3",
      "id" : "32655__greysound__frogsandcrickets-excerptb-jma-24bit-48k",
      "location" : "assets/32655__greysound__frogsandcrickets-excerptb-jma-24bit-48k.mp3",
      "tag" : [ "frogs" ],
      "state" : "idle",
      "volume": 1.0
    },

    "433783__cagancelik__campfire" : {
      "ui_id": "audio4",
      "id" : "433783__cagancelik__campfire",
      "location" : "assets/433783__cagancelik__campfire.mp3",
      "tag" : [ "campfire" ],
      "state" : "idle",
      "volume": 1.0
    },

    "517042__sonidosreales245__forestday-bw-66" : {
      "ui_id": "audio5",
      "id" : "517042__sonidosreales245__forestday-bw-66",
      "location" : "assets/517042__sonidosreales245__forestday-bw-66.mp3",
      "tag" : [ "birds" ],
      "state" : "idle",
      "volume": 1.0
    },

    "252645__yetcop__cat-purr-gato-ronroneando" : {
      "ui_id": "audio6",
      "id" : "252645__yetcop__cat-purr-gato-ronroneando",
      "location" : "assets/252645__yetcop__cat-purr-gato-ronroneando.mp3",
      "tag" : [ "purr" ],
      "state" : "idle",
      "volume": 1.0
    },

    "501115__felix-blume__peal-of-church-bells-on-sunday-in-paris" : {
      "ui_id": "audio7",
      "id" : "501115__felix-blume__peal-of-church-bells-on-sunday-in-paris",
      "location" : "assets/501115__felix-blume__peal-of-church-bells-on-sunday-in-paris.mp3",
      "tag" : [ "church", "bells" ],
      "state" : "idle",
      "volume": 1.0
    },


    "60956__muvee69__int-subway-station" : {
      "ui_id": "audio8",
      "id" : "60956__muvee69__int-subway-station",
      "location" : "assets/60956__muvee69__int-subway-station.mp3",
      "tag" : [ "subway" ],
      "state" : "idle",
      "volume": 1.0
    },

    "525052__smand__wind-chime-small.mp3" : {
      "ui_id": "audio9",
      "id" : "525052__smand__wind-chime-small.mp3",
      "location" : "assets/525052__smand__wind-chime-small.mp3",
      "tag" : [ "chimes" ],
      "state" : "idle",
      "volume": 1.0
    },

    "448378__keng-wai-chane-chick-te__city-brussels-street-morning" : {
      "ui_id": "audio10",
      "id" : "448378__keng-wai-chane-chick-te__city-brussels-street-morning",
      "location" : "assets/448378__keng-wai-chane-chick-te__city-brussels-street-morning.mp3",
      "tag" : [ "city" ],
      "state" : "idle",
      "volume": 1.0
    },


    "394290__epicwizard__bar-crowd-in-belgrade" : {
      "ui_id": "audio11",
      "id" : "394290__epicwizard__bar-crowd-in-belgrade",
      "location" : "assets/394290__epicwizard__bar-crowd-in-belgrade.mp3",
      "tag" : [ "bar" ],
      "state" : "idle",
      "volume": 1.0
    },

    "197804__7778__indoor-fish-tank-without-bubble-strips-ambiance" : {
      "ui_id": "audio12",
      "id" : "197804__7778__indoor-fish-tank-without-bubble-strips-ambiance",
      "location" : "assets/197804__7778__indoor-fish-tank-without-bubble-strips-ambiance.mp3",
      "tag" : [ "fishtank" ],
      "state" : "idle",
      "volume": 1.0
    },

    "234458__theonlycanvas__dryer" : {
      "ui_id": "audio13",
      "id" : "234458__theonlycanvas__dryer",
      "location" : "assets/234458__theonlycanvas__dryer.mp3",
      "tag" : [ "dryer" ],
      "state" : "idle",
      "volume": 1.0
    },

    "345029__3bagbrew__evening-call-to-prayer" : {
      "ui_id": "audio14",
      "id" : "345029__3bagbrew__evening-call-to-prayer",
      "location" : "assets/345029__3bagbrew__evening-call-to-prayer.mp3",
      "tag" : [ "prayer" ],
      "state" : "idle",
      "volume": 1.0
    },

    "273643__sanctuarymuch__ethereal-voices" : {
      "ui_id": "audio15",
      "id" : "273643__sanctuarymuch__ethereal-voices",
      "location" : "assets/273643__sanctuarymuch__ethereal-voices.mp3",
      "tag" : [ "voice" ],
      "state" : "idle",
      "volume": 1.0
    },

    "530715__jjbbllkk__rmr-morphagene-reels-choirs-02" : {
      "ui_id": "audio16",
      "id" : "530715__jjbbllkk__rmr-morphagene-reels-choirs-02",
      "location" : "assets/530715__jjbbllkk__rmr-morphagene-reels-choirs-02.mp3",
      "tag" : [ "choir" ],
      "state" : "idle",
      "volume": 1.0
    },


    "521549__buddhassoundofsilence__singing-bowl-deep-sound" : {
      "ui_id": "audio17",
      "id" : "521549__buddhassoundofsilence__singing-bowl-deep-sound",
      "location" : "assets/521549__buddhassoundofsilence__singing-bowl-deep-sound.mp3",
      "tag" : [ "bowl" ],
      "state" : "idle",
      "volume": 1.0
    },

    "320351__guardian2433__police-radio-chatter" : {
      "ui_id": "audio18",
      "id" : "320351__guardian2433__police-radio-chatter",
      "location" : "assets/320351__guardian2433__police-radio-chatter.mp3",
      "tag" : [ "police", "scanner" ],
      "state" : "idle",
      "volume": 1.0
    },

    "133099__allh__steam-train-interior_e" : {
      "ui_id": "audio19",
      "id" : "133099__allh__steam-train-interior_e",
      "location" : "assets/133099__allh__steam-train-interior_e.mp3",
      "tag" : [ "passenger", "coach" ],
      "state" : "idle",
      "volume": 1.0
    },

    "260105__joshs__train" : {
      "ui_id": "audio20",
      "id" : "260105__joshs__train",
      "location" : "assets/260105__joshs__train.mp3",
      "tag" : [ "train", "horn" ],
      "state" : "idle",
      "volume": 1.0
    },

    "324404__joedeshon__film-static-03" : {
      "ui_id": "audio21",
      "id" : "324404__joedeshon__film-static-03",
      "location" : "assets/324404__joedeshon__film-static-03.mp3",
      "tag" : [ "film", "static" ],
      "state" : "idle",
      "volume": 1.0
    }

  },

  "preset": {

    "preset0": {
      "name": "city nights",
      "value" : [
        { "id": "156049__ali-k__spring-night-rain2-evosmos-salonika-03-15-15-05", "volume" : 0.5 },
        { "id": "197804__7778__indoor-fish-tank-without-bubble-strips-ambiance", "volume" : 1.0 },
        { "id": "394290__epicwizard__bar-crowd-in-belgrade", "volume" : 0.5 },
        { "id": "60956__muvee69__int-subway-station", "volume" : 0.15 },
        { "id": "234458__theonlycanvas__dryer", "volume" : 0.15 },
        { "id": "345029__3bagbrew__evening-call-to-prayer", "volume" : 0.25 },
        { "id": "448378__keng-wai-chane-chick-te__city-brussels-street-morning", "volume" : 0.5 },
        { "id": "320351__guardian2433__police-radio-chatter", "volume" : 0.10 }
      ]
    },

    "preset1": {
      "name": "enchanted forest",
      "value" : [
        { "id": "155940__ali-k__small-waterfall-pentalofos-salonika-21-33-30-04", "volume" : 0.25 },
        { "id": "32655__greysound__frogsandcrickets-excerptb-jma-24bit-48k", "volume" : 0.10 },
        { "id": "525052__smand__wind-chime-small.mp3", "volume" : 0.20 },
        { "id": "521549__buddhassoundofsilence__singing-bowl-deep-sound", "volume" : 0.40 },
        { "id": "273643__sanctuarymuch__ethereal-voices", "volume" : 0.5 }
      ]
    },

    "preset2": {
      "name": "himmel beach",
      "value" : [
        { "id": "32655__greysound__frogsandcrickets-excerptb-jma-24bit-48k", "volume" : 0.10 },
        { "id": "450755__florianreichelt__waves-of-hawaii", "volume" : 0.40 },
        { "id": "517042__sonidosreales245__forestday-bw-66", "volume" : 0.30 },
        { "id": "530715__jjbbllkk__rmr-morphagene-reels-choirs-02", "volume" : 0.50 }
      ]
    },

    "preset3": {
      "name": "campin' with mom",
      "value" : [
        { "id": "155940__ali-k__small-waterfall-pentalofos-salonika-21-33-30-04", "volume" : 0.25 },
        { "id": "32655__greysound__frogsandcrickets-excerptb-jma-24bit-48k", "volume" : 0.10 },
        { "id": "433783__cagancelik__campfire", "volume" : 0.90 },
        { "id": "517042__sonidosreales245__forestday-bw-66", "volume" : 0.35 }
      ]
    },

    "preset4": {
      "name": "lazy sunday",
      "value" : [
        { "id": "156049__ali-k__spring-night-rain2-evosmos-salonika-03-15-15-05", "volume" : 0.4 },
        { "id": "197804__7778__indoor-fish-tank-without-bubble-strips-ambiance", "volume" : 1.0 },
        { "id": "525052__smand__wind-chime-small.mp3", "volume" : 0.10 },
        { "id": "252645__yetcop__cat-purr-gato-ronroneando", "volume" : 0.75 },
        { "id": "234458__theonlycanvas__dryer", "volume" : 0.25 }
      ]
    },

  },

  "custom_preset": "",

  "ui_id":{ }
}


function s4() {
  return Math.floor((1 + Math.random()) * 0x10000)
    .toString(16)
    .substring(1);
};

function guid() {
  return s4() + s4() + '-' +
         s4() + '-' +
         s4() + '-' +
         s4() + '-' + s4() + s4() + s4();
}


function _tohex(n, _len) {
  var s = n.toString(16);
  if (typeof _len !== "undefined") {
    if (s.length < _len) {
      var _dn = (_len - s.length);
      for (var ii=0; ii<_dn; ii++) {
        s = "0" + s;
      }
    }
  }
  return s;
}

function _unencode(_s) {
  var _res = "";
  for (var ii=0; ii<_s.length; ii+=2) {
    if ((ii+1)>=(_s.length)) { continue; }
    var a = parseInt(_s[ii], 16);
    var b = parseInt(_s[ii+1], 16);

    var u = a*16 + b;
    if ((u<32) || (u>128)) { continue; }

    _res += String.fromCharCode(u);
  }

  return _res;
}

function _custom_preset_ui_append(ui_id, _name, enc_volume) {
  var div_ele = document.getElementById("ui_custom_preset.list");

  var _name_u = _unencode(_name);
  var _name_str = _name_u.replace(/([^ a-zA-Z_-]*)/g, '');

  var _row = document.createElement("div");
  _row.classList.add("pure-g");
  _row.classList.add("row");

  var _col0 = document.createElement("div");
  _col0.classList.add("pure-u-2-3");
  _col0.classList.add("col");
  _col0.setAttribute("style", "margin:auto;");

  var _span0 = document.createElement("span");
  _span0.setAttribute("style", "margin:auto; font-size:1.5em; font-weight:bold; vertical-align:center; color:#555;");
  _span0.innerHTML = _name_str;

  var _col1 = document.createElement("div");
  _col1.classList.add("pure-u-1-3");
  _col1.classList.add("col");

  var _button1 = document.createElement("button");
  _button1.classList.add("bdropinp");
  _button1.classList.add("bkey");
  _button1.onclick = (function(x) { return function() { _load_preset_string(x); }; })(enc_volume);
  _button1.innerHTML = "load";

  _col0.appendChild(_span0);
  _col1.appendChild(_button1);
  _row.appendChild(_col0);
  _row.appendChild(_col1);
  div_ele.appendChild(_row);

}

function _custom_preset_ui_clear(xx) {
  var div_ele = document.getElementById("ui_custom_preset.list");

  div_ele.innerHTML = "";
  noixer_info.custom_preset = "";
  localStorage.setItem("custom_preset", "");
}

function _custom_preset_ui_save() {
  var name_val = document.getElementById('ui_custom_preset.name').value;
  var preset_str = _create_preset_string();

  var name_val_enc = "";
  for (var ii=0; ii<name_val.length; ii++) {
    name_val_enc += _tohex(name_val.charCodeAt(ii), 2);
  }

  var fin = name_val_enc + "#" + preset_str;

  if (noixer_info.custom_preset.length > 0) {
    noixer_info.custom_preset += ";";
  }
  noixer_info.custom_preset += fin;

  localStorage.setItem("custom_preset", noixer_info.custom_preset);

  _custom_preset_ui_append(guid(), name_val_enc, preset_str);

  history.replaceState(null, 'noixer', '?preset=' + preset_str);

  return fin;
}

function _load_preset_string(_preset_str) {

  _stop_all();

  if (_preset_str.length == 0) {
    console.log("WARNING: _load_preset_string: bad _preset_str:", _preset_str);
    return;
  }

  history.replaceState(null, 'noixer', '?preset=' + _preset_str);

  var pair = _preset_str.split(":");
  for (var idx=0; idx<pair.length; idx++) {
    var tok = pair[idx].split("-");

    var ui_id = "audio" + parseInt(tok[0], 16).toString();
    var vol   = parseInt(tok[1], 16)/256.0;

    _sound_volume(ui_id, vol);

    var sound_info = noixer_info.ui_id[ui_id];

    sound_info.state = "play";
    _sound_play(ui_id);
    _ui_toggle(ui_id + ".toggle", "play");

  }

}

function _create_preset_string() {
  var snd = noixer_info.sound;

  var preset_str = "";
  for (var snd_key in snd) {
    var sound_info = snd[snd_key];
    if (sound_info.state != "play") { continue; }

    var ui_int_id = parseInt(sound_info.ui_id.replace('audio', ''));

    var _aid = _tohex(ui_int_id, 2);
    var _vol = _tohex(Math.floor(sound_info.volume * 255.0), 2);

    if (preset_str.length > 0) {
      preset_str += ":";
    }
    preset_str += _aid + "-" +  _vol;
  }

  return preset_str;
}

function _sound_play(ui_id) {
  var ele = document.getElementById(ui_id);

  if (ele.readyState == 4) {
    ele.play();
    ele.loop = true;
  }
  else {
    setTimeout( function() { console.log("..."); _sound_play(ui_id); }, 250 );
  }
}

function _sound_stop(ui_id) {
  var ele = document.getElementById(ui_id);
  ele.pause();
}

function _sound_volume(ui_id, vol) {
  var ele = document.getElementById(ui_id);
  ele.volume = vol;

  var sound_info = noixer_info.ui_id[ui_id];
  sound_info.volume = vol;
}

function _ui_toggle(ui_id, state) {
  var ele = document.getElementById(ui_id);

  if (state == "play") {
    ele.innerHTML = "x";
  }
  else {
    ele.innerHTML = "";
  }
}

function _stop_all() {
  for (var sound_id in noixer_info.sound) {
    var info = noixer_info.sound[sound_id];
    if (typeof info.id === "undefined") { continue; }

    _sound_stop(info.ui_id);
    _ui_toggle(info.ui_id + ".toggle", "stop");

    noixer_info.sound[sound_id].state = "stop";
  }
}

function _click_change(ui_id) {
  var tok = ui_id.split(".");
  if (tok.length < 2) { return; }

  var _id = tok[0];
  var _opt = tok[1];

  var _noix_data = noixer_info.ui_id[_id];

  if (typeof _noix_data === "undefined") {
    console.log("_click_change: NOT FOUND", _id);
    return;
  }

  if (_opt == "toggle") {
    if ((_noix_data.state == "idle") || (_noix_data.state == "stop")) {
      _noix_data.state = "play";
      _sound_play(_id);
      _ui_toggle(ui_id, "play");
    }
    else if (_noix_data.state == "play") {
      _noix_data.state = "stop";
      _sound_stop(_id);

      _ui_toggle(ui_id, "stop");
    }
  }

}

function _slider_change(ui_id) {
  var tok = ui_id.split(".");
  if (tok.length < 2) { return; }

  var _id = tok[0];
  var _opt = tok[1];
  var _noix_data = noixer_info.ui_id[_id];

  if (typeof _noix_data === "undefined") {
    console.log("_slider_change: NOT FOUND", _id);
    return;
  }

  if (_opt == "volume") {
    var _vol = document.getElementById(ui_id);
    _sound_volume(_id, _vol.value);
  }


}

function testplay() {
  var tid = "156049__ali-k__spring-night-rain2-evosmos-salonika-03-15-15-05";
  var url = noixer_info.sound[tid].location;

  var audio = new Audio(url);
  audio.play();
}

function _preset_load(preset_id) {
  var preset_info = noixer_info.preset[preset_id];

  if (typeof preset_info === "undefined") {
    console.log("ERROR: no preset info found for", preset_id);
    return;
  }

  var sound_info = noixer_info.sound;

  _stop_all();

  for (var idx=0; idx<preset_info.value.length; idx++) {
    var entry = preset_info.value[idx];
    var snd_id = entry.id;
    var volume = entry.volume;
    var ui_id = sound_info[snd_id].ui_id;

    noixer_info.sound[snd_id].state = "play";

    _ui_toggle(ui_id + ".toggle", "play");
    _sound_play(ui_id);
    _sound_volume(ui_id, volume);

    var ui_slider = document.getElementById( ui_id + ".volume");
    ui_slider.value = volume;
  }
}

function noixer_ui_setup() {

  // presets
  //
  var ui_preset = document.getElementById("ui_preset");
  for (var preset_id in noixer_info.preset) {
    var preset_info = noixer_info.preset[preset_id];

    var _name = preset_info.name;

    var ui_id = preset_id;

    var _divrow = document.createElement("div");
    _divrow.classList.add("pure-g");
    _divrow.classList.add("row");

    var _divcol0 = document.createElement("div");
    _divcol0.classList.add("pure-u-1-2");
    _divcol0.classList.add("col");
    _divcol0.setAttribute("style", "margin:auto;");

    var _span0 = document.createElement("span");
    _span0.setAttribute("style", "font-size:1.3em; font-weight:bold; color:#555;");
    _span0.innerHTML = _name;

    //--

    var _divcol1 = document.createElement("div");
    _divcol1.classList.add("pure-u-1-2");
    _divcol1.classList.add("col");

    var _button1 =document.createElement("button");
    _button1.classList.add("bdropinp");
    _button1.classList.add("bkey");
    _button1.id = ui_id + ".toggle";
    _button1.onclick = (function(x) { return function() { _preset_load(x); }; })(ui_id);
 
    //--



    //--

    _divcol0.appendChild(_span0);
    _divrow.appendChild(_divcol0);

    _divcol1.appendChild(_button1);
    _divrow.appendChild(_divcol1);

    ui_preset.appendChild(_divrow);

  }

  // html audio elements
  //
  var ui_sounds = document.getElementById("ui_sounds");
  for (var sound_id in noixer_info.sound) {
    var sound_info = noixer_info.sound[sound_id];
    if (typeof sound_info.id === "undefined") { continue; }

    var _audio = document.createElement("audio");
    _audio.id = sound_info.ui_id;

    _audio.setAttribute("preload", "auto");
    _audio.setAttribute("src", sound_info.location);

    ui_sounds.appendChild(_audio);
  }

  // setup controls (toggle button, slider, name)
  // for each sound
  //
  var ui_container = document.getElementById("ui_container");
  //for (var sound_id in noixer_info.sound) {
  for (var idx=0; idx<noixer_info.sound_order.length; idx++) {
    var sound_id = noixer_info.sound_order[idx];
    var sound_info = noixer_info.sound[sound_id];
    if (typeof sound_info.id === "undefined") { continue; }

    var ui_id = sound_info.ui_id;

    var _divrow = document.createElement("div");
    _divrow.classList.add("pure-g");
    _divrow.classList.add("row");

    var _divcol0 = document.createElement("div");
    _divcol0.classList.add("pure-u-1-4");
    _divcol0.classList.add("col");
    _divcol0.setAttribute("style", "margin:auto;");

    var _span0 = document.createElement("span");
    _span0.setAttribute("style", "font-size:1.3em; font-weight:bold; color:#555;");
    _span0.innerHTML = sound_info.tag.join(" ");

    //---

    var _divcol1 = document.createElement("div");
    _divcol1.classList.add("pure-u-1-4");
    _divcol1.classList.add("col");
    //_divcol1.setAttribute("style", "margin-top:3vh;");

    var _button1 =document.createElement("button");
    _button1.classList.add("bdropinp");
    _button1.classList.add("bkey");
    _button1.id = ui_id + ".toggle";
    _button1.onclick = (function(x) { return function() { _click_change(x + ".toggle"); }; })(ui_id);
 
    //--

    var _divcol2 = document.createElement("div");
    _divcol2.classList.add("pure-u-1-2");
    _divcol2.classList.add("col");
    _divcol2.setAttribute("style", "margin-top:17px;");

    var _input2 = document.createElement("input");
    _input2.id = ui_id + ".volume";
    _input2.setAttribute("type", "range");
    _input2.setAttribute("value", "1.0");
    _input2.setAttribute("min", "0.0");
    _input2.setAttribute("max", "1.0");
    _input2.setAttribute("step", "0.05");
    _input2.onchange = (function(x) { return function() { _slider_change(x + ".volume"); }; })(ui_id);
    _input2.oninput= (function(x) { return function() { _slider_change(x + ".volume"); }; })(ui_id);

    //--

    _divcol0.appendChild(_span0);
    _divrow.appendChild(_divcol0);

    _divcol1.appendChild(_button1);
    _divrow.appendChild(_divcol1);

    _divcol2.appendChild(_input2);
    _divrow.appendChild(_divcol2);

    ui_container.appendChild(_divrow);

  }


  // setup custom presets from localstorage
  //
  var custom_preset_data = localStorage.getItem("custom_preset");
  if ((custom_preset_data !== null) &&
      (typeof custom_preset_data !== "undefined") &&
      (custom_preset_data.length > 0)) {
    noixer_info.custom_preset = custom_preset_data;

    var _preset_str = custom_preset_data.split(";");
    for (var ii=0; ii<_preset_str.length; ii++) {
      var name_dat = _preset_str[ii].split("#");
      if (name_dat.length != 2) { continue; }
      var _name = name_dat[0];
      var _dat = name_dat[1];

      _custom_preset_ui_append(guid(), _name, _dat);
    }

  }

  var url_tok = window.location.href.split("?");
  if (url_tok.length > 1)  {
    var tok = url_tok[1].split("&");
    for (var ii=0; ii<tok.length; ii++) {
      var kv = tok[ii].split("=");
      if (kv.length != 2) { continue; }
      if (kv[0] == "preset") {
        _load_preset_string(kv[1]);
        break;
      }
    }
  }

}

function noixer_init() {

  for (var key in noixer_info.sound) {
    if (key.length == 0) { continue; }
    var _noix_data = noixer_info.sound[key];
    var ui_id = _noix_data.ui_id;
    noixer_info.ui_id[ui_id] = _noix_data;
  }

  noixer_ui_setup();

}




